<!DOCTYPE html>
<html lang="en-CA">

    <!-- lang="en" specifies the language of the page for help with search engines-->

    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KLFC03JGT"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-6KLFC03JGT');
        </script>
        
        <title>Graeme Dockrill | Bearing Housing</title>
        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
        <link rel="stylesheet" type="text/css" href="../stylesheet.css">
        
        <meta name="Author" content="Graeme Dockrill">
    </head>

    <body>

        <div class="capstoneheader">
            <h2 style="color:#ffffff;">John <span style="color:#2E74B5">Graeme Dockrill</span> | Mechatronics Engineering</h2>
            <h3 style="color:#ffffff;">6th Year Student at UBC | graeme.dockrill01@gmail.com</h3>
        </div>

        <!--Create a menu at the top of the page-->
        <div id="navbar">
            <a href="../index.html">Home</a>
            <a href="../resume.html">Resume</a>
            <a href="../projects.html">Projects</a>
            <a href="../courses.html">Courses</a>
            <a href="../pictures.html">Pictures</a>
            <a href="../about.html">About</a>
            <a href="https://www.linkedin.com/in/graemedockrill/" target="_blank">Linkedin</a>
            <a href="mailto:graeme.dockrill01@gmail.com" title="graeme.dockrill01@gmail.com">Email Me</a>

            <div id="secondary">
                <a class="active">Cell Stretcher</a>
            </div>
        </div>

        <div class="content">

            <div class="aprojmain">
                <h1 style="text-align:center;">Cell Stretching Device Capstone (Will Add More Info)</h1>
                <p style="font-size: 125%; text-align: center;">September 2023 - April 2024</p>
                <hr>

                <!--This stuff is for the project overview header-->
                <div class="resumerow">

                    <div class="resumecol">

                        <div class="projinfo">

                            <table class="projtable">
                                <tr>
                                    <td>
                                        <h3 style="font-size: 150%; text-align: center;">Project Overview</h3>
                                    </td>
                                    <td colspan="2">
                                        <h3 style="font-size: 150%; text-align: center;">Developed Skills</h3>
                                    </td>
                                    <td></td>
                                </tr>

                                <tr>
                                    <td>
                                        <ol>
                                            <li>Consulted with UBC MEMS lab and BC Children's Hospital to design and fabricate a device to mature human heart cells, through cyclic stress application</li>
                                            <li>Designed, implemented and tested firmware system and implemented on i.MX RT1060 MCU using FreeRTOS</li>
                                            <li>Created multithreaded Python control program for communicating with the device and recording data</li>
                                            <li>Designed, implemented and tested electrical control circuit for 4 stepper motors and 2 load cells</li>
                                            <li>Designed linear stage to stretch human heart cells planted on a membrane using 4 stepper motors</li>
                                        </ol>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>Embedded Design</li>
                                            <li>FreeRTOS</li>
                                            <li>Multithreading</li>
                                            <li>Data Acquisition</li>
                                            <li>UI Design</li>
                                            <li>Trajectory Planning</li>
                                            <li>Electrical Design</li>
                                            <li>Mechanical Design</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>C++ Programming</li>
                                            <li>Python Programming</li>
                                            <li>Serial Communication</li>
                                            <li>Electrical Troubleshooting</li>
                                            <li>System Integration</li>
                                            <li>System Testing</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="projobjective">
                <h3 style="font-size: 150%; text-align: center;">Objective</h3>
                <p>This project was my capstone in my last year of my Mechatronics Engineering degree at UBC. The objective of this project was to work with the UBC Microelectromechanical Systems (MEMS) lab, as well as the BC Children's Hospital to design and fabricate a device for maturing human heart cells through cyclic stretching, as well as the ability to image the process under an inverted microscope.</p>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="half image">
                        <img src="projectimages/Capstone/heart_cell_maturation.jpg" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Heart Cell Maturation</p>
                    </div>

                    <div class="half text">
                        <h3 style="font-size: 150%;">Brief Background</h3>
                        <p>The UBC MEMS lab has requested a device that can stretch human heart cells and replicate the human heart environment while allowing the cells to be imaged.</p>
                        <p>This will allow the lab to mature freshly differentiated heart cells and observe the maturation process to ensure smooth stretching.</p>
                        <p>The MEMS lab will also be able to study the stress response of the heart cells in detail.</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="full text">
                        <h3 style="font-size: 150%; text-align: center;">System Overview</h3>
                        <p>The general overview of the system is shown in the flow chart below.</p>
                        <p>On the Python control program side, the user gives input to send parameters to the MCU and also to receive logging data from the sensors to record and display in real-time.</p>
                        <p>On the firmware side, the MCU is running FreeRTOS with 3 tasks running.</p>
                        <p>On the Electrical side, there are the encoders, load cells, the stepper motors, and their drivers.</p>
                        <p>On the mechanical system side, there are the linear stages and the PDMS membrane.</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="full projpageimage">
                        <img src="projectimages/Capstone/system_overview.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">System Overview</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="half text">
                        <h3 style="font-size: 150%;">Mechanical Design</h3>
                        <p>The device had compatibility constraints where it had to fit with the existing microscope and environmental control unit (ECU) pieces.</p>
                        <p>The device needed to have independent stretching control on each axis of the PDMS membrane, with an extreme importance placed on precision.</p>
                    </div>

                    <div class="half image">
                        <img src="projectimages/Capstone/device_iso.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">CAD Rendering of Final Device</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="full text">
                        <h3 style="font-size: 150%; text-align: center;">Linear Stage Design</h3>
                        <p>The linear stage uses a linear rail with a linear carriage, an ultra precision lead screw, a flange mount bearing, and a flexible coupling.</p>
                        <p>On top of the linear carriage, a block is mounted. On this block a long strut that enters the ECU chamber is attached.</p>
                        <p>At the end of this strut, a load cell is fixed, which has the grippers for attaching to the membrane mounted on the end.</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="half projpageimage">
                        <img src="projectimages/Capstone/linear_stage_right.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Linear Stage Right View</p>
                    </div>

                    <div class="half projpageimage">
                        <img src="projectimages/Capstone/linear_stage_exploded.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Linear Stage Exploded View</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="third projpageimage">
                        <img src="projectimages/Capstone/carriage_block_machined.jpg" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Machined Carriage Blocks</p>
                    </div>

                    <div class="third projpageimage">
                        <img src="projectimages/Capstone/linear_stage_physical.jpg" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Linear Stage Assembled</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="third projpageimage">
                        <img src="projectimages/Capstone/base_plate_mid_machine.jpg" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Mid-Waterjet Baseplate</p>
                    </div>

                    <div class="third projpageimage">
                        <img src="projectimages/Capstone/prototype_mid_assembly.jpg" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Rough Prototype Assembly</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="third image">
                        <img src="projectimages/Capstone/circuit.png" class="imageborder" style="width:50%;">
                        <p style="margin-top: 0; text-align: center;">Protoboard Circuit</p>
                    </div>

                    <div class="half text">
                        <h3 style="font-size: 150%;">Electrical Design</h3>
                        <p>The electrical design consisted of a Teensy 4.1 MCU, two ADC modules for our load cells, a logic level shifter for reading the encoders (as encoder signals were 5V, but Teensy pins are only rated for 3.3V)</p>
                        <p>For the external stepper motor drivers, a MOSFET switching circuit was used to allow current to flow through internal optocouplers (same issue of drivers using 5V and Teensy using 3.3V).</p>
                        <p>To clean up the wiring between the motors, encoders, drivers, and circuit board, 4-pin and 12-pin Mollex connectors were used.</p>
                        <p>We would have tried creating a PCB, however we were very short on time, so we used a prototyping board instead.</p>
                    </div>
                </div>

                <br>
                
                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="half text">
                        <h3 style="font-size: 150%; text-align: center;">Software Design</h3>
                        <p>For the software of this project, there were two main parts. The firmware for the i.MU RT1060, and the multithreaded Python control program.</p>
                        <p>The control program handles the user input, communication of commands to the MCU, and the recording/display of data in real-time.</p>
                        <p>The firmware of the device is written in C++ and is using FreeRTOS, with 3 main tasks below:</p>
                        <li>Serial Task: Handles reading and writing between the Python control program and the microcontroller. Also sends trajectories to the Motor Control Task using FreeRTOS queues.</li>
                        <li>Data Logger Task: Reads the load cell ADCs and the current encoder positions at regular intervals, packages the data with a timestamp and sends it to the Serial Task with a FreeRTOS queue.</li>
                        <li>Motor Control Task: Receives trajectory parameters from Serial Task and generates trajectories using a trapezoidal velocity profile.</li>
                        <p>A picture of the control program (implemented in tkinter) is shown below.</p>
                    </div>

                    <div class="half image">
                        <img src="projectimages/Capstone/software_flow.png" class="imageborder" style="width:100%;">
                        <p style="margin-top: 0; text-align: center;">General Software Flow Chart</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="full projpageimage">
                        <img src="projectimages/Capstone/control_program.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Control Program</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="half image">
                        <img src="projectimages/Capstone/trajectory_generation.png" class="imageborder" style="width:100%;">
                        <p style="margin-top: 0; text-align: center;">Trajectory Generation Sketch</p>
                    </div>

                    <div class="half text">
                        <h3 style="font-size: 150%;">Trajectory Generation</h3>
                        <p>For the motors to move from the current position to the target position, a trajectory was required, with a velocity ramp to prevent the stepper from skipping steps.</p>
                        <p>The inputs for generating a trajectory are the initial position, target position, and the average velocity, and from this, the required timer interrupts were set for stepping the motor and incrementing the stepping interrupt (acceleration).</p>
                    </div>
                </div>

                <br>

                <!--This stuff is for the project content-->
                <div class="box">
                    <div class="full projpageimage">
                        <img src="projectimages/Capstone/stepper_acceleration_profile.png" class="imageborder" style="width:100%">
                        <p style="margin-top: 0; text-align: center;">Stepper Acceleration Profile</p>
                    </div>
                </div>
                
                <hr>

                <!--Final remarks-->
                <div class="resumerow">

                    <div class="resumecol">

                        <div class="projinfo">

                            <h3 style="font-size: 150%; text-align: center;">Final Remarks</h3>
                            <p>Through this project, I learned a lot about mechanical design, firmware, RTOS, python, OOP, electrical design, debugging, and integration.</p>
                            <p>This page is still under construction, as more information and reflections will be added.<p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="footer">
            <p>Â© Copyright 2023 Graeme Dockrill</p>
        </div>

        <!--JavaScript for keeping the menu bar attached to the top of the screen-->
        <script>
            window.onscroll = function() {StickyBar()};

            var navbar = document.getElementById("navbar");
            var sticky = navbar.offsetTop;

            function StickyBar(){
                if(window.pageYOffset >= sticky){
                    navbar.classList.add("sticky")
                }
                else{
                    navbar.classList.remove("sticky");
                }
            }
        </script>

        <script type="module">

            // Import the functions you need from the SDKs you need
        
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        
            // TODO: Add SDKs for Firebase products that you want to use
        
            // https://firebase.google.com/docs/web/setup#available-libraries
        
        
            // Your web app's Firebase configuration
        
            const firebaseConfig = {
        
            apiKey: "AIzaSyD9IY42OqZVft0G-RnTfg_gH1neTS5UDN0",
        
            authDomain: "portfolio-website-c1dc9.firebaseapp.com",
        
            projectId: "portfolio-website-c1dc9",
        
            storageBucket: "portfolio-website-c1dc9.appspot.com",
        
            messagingSenderId: "94392532432",
        
            appId: "1:94392532432:web:d66a8858a2808711830dd5"
        
            };
        
        
            // Initialize Firebase
        
            const app = initializeApp(firebaseConfig);
        
        </script>

    </body>
</html> 